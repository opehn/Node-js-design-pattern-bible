# 싱글톤 패턴
싱글톤 패턴은 클래스의 인스턴스가 하나만 존재하도록 접근을 중앙집중화하는 것이다. 애플리케이션의 모든 컴포넌트가 단일 인스턴스를 사용하는 데는 몇가지 이유가 있다. 
- 상태 정보의 공유 
- 리소스 사용의 최적화
- 리소스에 대한 접근 동기화

싱글톤이 필요한 대표적인 예 : 데이터베이스에 접근하는 Database 클래스
이러한 클래스는 일반적으로 연결 풀(Connection pool)을 유지하므로 각 요청에 대해 새로운 Database 인스턴스를 만들 필요가 없다. 
또, 인스턴스에 대기중인 트랜잭션 목록 같은 일부 상태 정보를 저장할 수도 있다. 
따라서 Database 클래스는 싱글톤 패턴을 적용하기 위한 두 가지 기준을 충족한다.

Node.js에서 싱글톤 구현은 매우 쉽다. 모듈에서 인스턴스를 익스포트 하는것만으로 이미 싱글톤과 유사한 패턴을 얻을 수 있다.
``` js
// file 'dbInstance.js' 
import {Database} from './Database.js'

export const dbInstance = new Database('my-abb-db', {
    url: 'localhost:5432',
    username: 'user',
    password: 'password
})
```
Node.js의 모듈 시스템이 export된 모듈을 캐시해두기 때문에, 여러번 import 해도 하나의 인스턴스가 export 된다.
단순히 데이터베이스 클래스의 새로운 인스턴스를 내보내는 것으로 
이미 현재 패키지 내에 dbInstance 모듈의 인스턴스가 하나만 존재한다고 가정할 수 있다.
-> 의문 : 사용자가 클래스 정의 자체를 import 한다음에 new를 해버릴수도 있지 않나??

그러나 주의할 점은, 모듈이 전체 경로를 key로 해서 캐시되므로 현재 패키지 내에서만 싱글톤이 보장된다는 것이다. 
즉 dbInstance를 export 하는 A 패키지를 각각 다른 패키지에서 가져다 쓰고, 
그 두 개의 패키지가 같은 애플리케이션에 속해있다면, 애플리케이션에 dbInstance가 두 개가 된다.
(npm, yarn 등 패키지 매니저의 구현에 따라 달라지는 부분이다.)

이로인해 명시적으로 글로벌 변수를 사용하지 않는 한, 문헌에 기술된 대로의 싱긑톤 패턴은 Node.js에 존재하지 않는다.
``` js
global.dbInstance = new Database('my-app-db', {/*...*/});
```
이렇게 하면 패키지 내에서가 아닌 전체 애플리케이션에서 공유되는 유일한 인스턴스임을 보장할 수 있다. 
그러나 대부분의 경우 순수한 싱글톤이 필요하지 않다는 것을 이해할 필요가 있다. 
Node.js는 일반적으로 애플리케이션의 메인 패키지나 
최악의 경우라 하더라도 모듈화된 하위 컴포넌트로부터 싱글톤으로 생성해 임포트한다.